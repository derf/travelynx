var f=(e,r,o)=>new Promise((u,s)=>{var i=t=>{try{c(o.next(t))}catch(a){s(a)}},n=t=>{try{c(o.throw(t))}catch(a){s(a)}},c=t=>t.done?u(t.value):Promise.resolve(t.value).then(i,n);c((o=o.apply(e,r)).next())});var T=0,y=0,h=0,g="",p=[],w="";function m(){const e=document.querySelectorAll(".countdown");for(const r of e){const{token:o,journey:u,dest:s,route:i}=r.dataset;if(o&&(w=o),u){const[n,c]=u.split(";");y=n-c}if(s&&(g=s),i){const n=i.split("|");p=[];for(const c of n){const t=c.split(";");for(let a=1;a<5;a++)t[a]=parseInt(t[a]);p.push(t)}}}}function q(){const e=Date.now()/1e3,r=document.querySelector(".countdown");if(T>e){r.innerText="Abfahrt in "+Math.round((T-e)/60)+" Minuten";return}if(h<=e){r.innerText="Ziel erreicht";return}const o=Math.round((h-e)/60);o>=120?r.innerText="Ankunft in "+Math.floor(o/60)+" Stunden und "+o%60+" Minuten":o>=60?r.innerText="Ankunft in 1 Stunde und "+o%60+" Minuten":r.innerText="Ankunft in "+o+" Minuten"}function k(e){const r=new Date(e*1e3),o=r.getHours(),u=r.getMinutes();return(o<10?"0"+o:o)+":"+(u<10?"0"+u:u)}function b(e,r){return e<r?" (+"+(r-e)/60+")":e==r?"":" ("+(r-e)/60+")"}function d(e,r,o){const u='<i class="material-icons">error</i>';let s;e.dataset.tr?s='<tr><td colspan="'+e.dataset.tr+'"><div class="progress"><div class="indeterminate"></div></div></td></tr>':s='<div class="progress"><div class="indeterminate"></div></div>',e.style.display="none",e.after(s),fetch("/action",{method:"POST"}).then(i=>f(this,null,function*(){if(!i.ok)return;const{success:n,redirect_to:c,error:t}=yield i.json();if(n){window.location.href=c;return}M.toast({html:u+" "+t}),s.remove(),o&&o(),e.append(" "+u),e.style.display="block"}))}function v(){fetch("/ajax/status_card.html").then(e=>f(this,null,function*(){if(!e.ok){document.querySelector(".sync-failed-marker").style.display="block",q(),setTimeout(v,5e3);return}document.querySelector(".statuscol").innerHTML=yield e.text(),j(),m(),setTimeout(v,4e4)}))}function _(){let e,r=0;document.querySelectorAll(".publicstatuscol").forEach(o=>{e=o.dataset.user,r=parseInt(o.dataset.profile)}),fetch(`/ajax/status/${e}.html`,{headers:{"content-type":"application/json"},body:JSON.stringify({token:w,profile:r})}).then(o=>f(this,null,function*(){if(!o.ok){document.querySelector(".sync-failed-marker").style.display="block",q(),setTimeout(_,5e3);return}document.querySelector(".publicstatuscol").innerHTML=yield o.text(),m(),setTimeout(_,4e4)}))}function x(){fetch("/timeline/in-transit",{headers:{"content-type":"application/json"},body:'{"ajax": 1}'}).then(e=>{if(!e.ok){document.querySelector(".sync-failed-marker").style.display="block",setTimeout(x,1e4);return}})}function S(){const e=Date.now()/1e3;let r=0;if(y<=0)return;r=1-(h-e)/y,r<0&&(r=0),r>1&&(r=1),document.querySelector(".progress .determinate").style.width=`${r*100}%`;const o=document.querySelector(".next-stop");for(const u of p){const[s,i,n,c,t]=u;if(s==g){o.innerHTML="";break}if(n!=0&&n-e>0){o.innerHTML=`${s}<br/>${k(n)}${b(i,n)}`;break}if(t!=0&&t-e>0){o.innerHTML=`${s}<br/>${k(n)} \u2192 ${k(t)}${b(c,t)}`;break}}setTimeout(S,5e3)}function j(){var e,r,o,u,s;document.querySelector(".action-checkin").addEventListener("click",i=>{const n=i.currentTarget,{station:c,train:t,dest:a}=n.dataset;d(n,{action:"checkin",station:c,train:t,dest:a})}),document.querySelector(".action-checkout").addEventListener("click",i=>{const n=i.currentTarget,{station:c,force:t}=n.dataset;d(n,{action:"checkout",station:c,force:t},()=>{(!t||t==="false")&&(n.append(" \u2013 Ohne Echtzeitdaten auschecken?"),n.dataset.force="true")})}),(e=document.querySelector(".action-undo"))==null||e.addEventListener("click",i=>{const n=i.currentTarget;let{id:c,checkints:t}=n.dataset;t=parseInt(t);const a=Date.now()/1e3;let l=!0;a-t>900&&(l=confirm("Checkin wirklich r\xFCckg\xE4ngig machen? Er kann ggf. nicht wiederholt werden.")),l&&d(n,{action:"undo",undo_id:c})}),(r=document.querySelector(".action-cancelled-from"))==null||r.addEventListener("click",i=>{const n=i.currentTarget,{station:c,train:t}=n.dataset;d(n,{action:"cancelled_from",station:c,train:t})}),(o=document.querySelector(".action-cancelled-to"))==null||o.addEventListener("click",i=>{const n=i.currentTarget;d(n,{action:"cancelled_to",station:n.dataset.station,force:!0})}),(u=document.querySelector(".action-delete"))==null||u.addEventListener("click",i=>{const n=i.currentTarget,{id:c,checkin:t,checkout:a}=n.dataset,l={action:"delete",id:c,checkin:t,checkout:a};confirm("Diese Zugfahrt wirklich l\xF6schen? Der Eintrag wird sofort aus der Datenbank entfernt und kann nicht wiederhergestellt werden.")&&d(n,l)}),(s=document.querySelector(".action-share"))==null||s.addEventListener("click",i=>{const n=i.currentTarget;let{text:c,url:t}=n.dataset;if(navigator.share){let l={text:c};t&&(l={text:c,url:t}),navigator.share(l);return}const a=document.createElement("textarea");t&&(c+=" "+t),a.value=c,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),a.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(a),M.toast({html:`Text kopiert: \u201E${c}\u201C`})})}document.addEventListener("DOMContentLoaded",()=>{j(),document.querySelector(".statuscol .autorefresh")&&(m(),setTimeout(v,4e4),setTimeout(S,5e3)),document.querySelector(".publicstatuscol .autorefresh")&&(m(),setTimeout(_,4e4),setTimeout(S,5e3)),document.querySelector(".timeline-in-transit .autorefresh")&&setTimeout(x,6e4),document.querySelectorAll("a[href]").forEach(()=>{var r;return(r=document.querySelector("nav .preloader-wrapper"))==null?void 0:r.classList.add("active")});const e=document.querySelectorAll(".carousel");M.Carousel.init(e,{fullWidth:!0,indicators:!0})});
